<!DOCTYPE html>
<html>
<head>
  <title>Ebiz</title>
  <%= javascript_include_tag :defaults %>
  <style type="text/css">
      @media print
      {
          .NoPrint
          {
              display: none;
          }
      }
      .dotline
      {
          border-bottom-style: none;
          border-left-style: none;
          border-right-style: none;
          border-top-style: dashed;
          width: 100%;
      }
      .thinTableBorder
      {
          text-align: left;
          border-left: 1px solid #000000;
          border-top: 1px solid #000000;
      }
      .thinTableBorder td
      {
          border-right: 1px solid #000000;
          border-bottom: 1px solid #000000;
      }
      .noneTableBorder
      {
          border-style: none none none none;
      }
      .noneTableBorder td
      {
          border-right: 1px solid #000000;
          border-bottom-style: none;
          border-left-style: none;
          border-top-style: none;
      }
      .innerRightTd
      {
          border-right: none;
          border-bottom-style: none;
          border-left-style: none;
          border-top-style: none;
      }
      .blodText
      {
          font-weight: bold;
      }
      body
      {
          width: 100%;
          margin: 0 0px;
          padding: 0;
          font-size: 12px;
          font-family: Arial, Helvetica, sans-serif, "微软雅黑";
          vertical-align: baseline;
          /*line-height: 18px;*/
          clear: both;
      }
  </style>

  <style type="text/css">
         .innerTd
         {
             border-style: none solid solid none;
             border-width: 1px;
             border-color: #000000;
         }
         .rightTd
         {
             border-style: none none solid none;
             border-width: 1px;
             border-color: #000000;
         }
         .bottomTd
         {
             border-style: none solid none none;
             border-width: 1px;
             border-color: #000000;
         }
         .pageNext
         {
             page-break-after: always;
         }
     </style>

  <script language="javascript" type="text/javascript">
      var printArgs = { prePrint: function() { return true; }, printCallBack: function() { return false; } };
      function doPrint() {
          if (printArgs.prePrint()) {
              window.print();
              printArgs.printCallBack();
          }
      }
      jQuery(document).ready(function() {
          jQuery('#printDiv').css({ width: 128, height: 128 });

          setPosition();
          //响应窗体大小改变事件
          jQuery(window).resize(function() {
              setPosition();
          });
          //响应窗体滚动条移动事件
          jQuery(window).scroll(function() {
              setPosition();
          });

          jQuery('#imgPrinter').css({ filter: 'Alpha(opacity = 80)' }).mouseover(function() {
              jQuery(this).css({ filter: 'Alpha(opacity = 100)' });
          }).mouseout(function() {
              jQuery(this).css({ filter: 'Alpha(opacity = 80)' });
          });
      });

      function setPosition() {
          var top = jQuery(document.documentElement).scrollTop() + jQuery(window).height() / 2;
          var left = jQuery(document.documentElement).scrollLeft() + jQuery(window).width();
          jQuery('#printDiv').css({ left: left - 136, top: top - 20 });
      }
  </script>

   <script language="javascript" type="text/javascript">
       jQuery(document).ready(function() {
           printArgs.prePrint = function() {
           var ret = false;
             jQuery.ajax({
                       type: "POST",
                       url: "<%= order_order_prints_path %>",
                       data: { order_id: "<%= @order.id %>" },
                       dataType: "json",
                       success: function(result) {
                           if (result == 'failure') {
                               alert('打印记录保存失败!');
                           } else {
                                  ret = true;
                           }
                       },
                       cache: false, //禁止使用缓存
                       async: false//使用同步请求来设置返回值
                   });
               return ret;
           };
       });
   </script>

</head>
<body style="text-align: center;">
    <form name="aspnetForm" method="post"  id="aspnetForm">
    <div id='divContent'>
    <table width="690">
        <tr>
            <td align="center">
                <table width="100%" cellpadding="0" cellspacing="0" border="0">
                    <tr>
                        <td width="210" style="font-size: 11pt">
                            <img src='/images/printLogo.gif' width="60"
                                height="54" />轻松办公&nbsp;&nbsp;&nbsp;&nbsp;快乐生活
                        </td>
                        <td style="font-size: 20pt; padding-left: 30px;" align="left">
                            壹美壹家购物订单
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td style="font-size: 8pt" align="left">
                <table width="100%" cellpadding="0" cellspacing="0" border="0">
                    <tr>
                        <td>
                            订单号码：<%= @order.number %>
                        </td>
                        <td>
                            订单批次：<%= @order.batch %>
                        </td>
                        <td>
                            下单时间：<%= @order.created_at %>
                        </td>
                        <td>
                            制单人：  <%= get_make_by @order %>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            订单类型：<%= format_sku_type(@order.order_details[0].sku.sku_type) %>
                        </td>
                        <td>
                            订单状态：<%= @order.instance.station.name %>
                        </td>
                        <td colspan="2">
                            客&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;户：<%= get_user_name(@order.user)  %>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <!--订单明细开始-->
        <tr>
            <td>
                <table width="100%" cellpadding="0" cellspacing="0" style="border: 1px solid #000000;">
                    <tr>
                        <td class="innerTd">
                            #
                        </td>
                        <td class="innerTd">
                            商品编号
                        </td>
                        <td class="innerTd">
                            商品名称
                        </td>
                        <td class="innerTd">
                            素材编号
                        </td>
                        <td class="innerTd">
                            单位
                        </td>
                        <td class="innerTd">
                            型号
                        </td>
                        <td class="innerTd">
                            单价
                        </td>
                        <td class="innerTd">
                            数量
                        </td>
                        <td class="innerTd">
                            安装费
                        </td>
                        <td class="innerTd">
                            组装费
                        </td>
                        <td class="rightTd">
                            小计
                        </td>
                    </tr>
                    <% i = 0 %>
                    <% @order.order_details.each_with_index do |detail,index| %>
                      <% i = index %>
                      <tr>
                          <td class="innerTd">
                              <%= index+1 %>
                          </td>
                          <td class="innerTd">
                              <%= detail.sku.number %>
                          </td>
                          <td class="innerTd">
                              <%= detail.sku.name %>
                          </td>
                          <td class="innerTd">
                              <%= detail.sku.products[0].product_id %>
                          </td>
                          <td class="innerTd">
                              <%= detail.sku.unit %>
                          </td>
                          <td class="innerTd">
                              <%= detail.sku.model %>
                          </td>
                          <td class="innerTd">
                              <%= detail.unit_price %>
                          </td>
                          <td class="innerTd">
                              <%= detail.quantity %>
                          </td>
                          <td class="innerTd">
                              <%= detail.install_cost %>
                          </td>
                          <td class="innerTd">
                              <%= detail.assemble_cost %>
                          </td>
                          <td class="rightTd">
                              <%= detail.unit_price*detail.quantity %>
                          </td>
                      </tr>
                    <% end %>
                      <% if i < 9  %>
                        <% (9-i).times.each do %>
                          <tr>
                            <td class="innerTd">
                                &nbsp;
                            </td>
                            <td class="innerTd">
                                &nbsp;
                            </td>
                            <td class="innerTd">
                                &nbsp;
                            </td>
                            <td class="innerTd">
                                &nbsp;
                            </td>
                            <td class="innerTd">
                                &nbsp;
                            </td>
                            <td class="innerTd">
                                &nbsp;
                            </td>
                            <td class="innerTd">
                                &nbsp;
                            </td>
                            <td class="innerTd">
                                &nbsp;
                            </td>
                            <td class="innerTd">
                                &nbsp;
                            </td>
                            <td class="innerTd">
                                &nbsp;
                            </td>
                            <td class="rightTd">
                                &nbsp;
                            </td>
                          </tr>
                        <% end %>
                      <% end %>
                    <tr>
                        <td colspan="11" align="right" style="border-style: none none none none; border-width: 1px; border-color: #000000;padding-right:10px">
                           其他费用：<%= @order.other_cost %>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;运费：<%= @order.carriage_cost %>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;合计金额：<%= @order.total_amount %>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td>
                <table width="100%" cellpadding="0" cellspacing="0" border="0">
                    <tr>
                        <td style="font-size: 12pt; font-weight: bold">
                            www.emehome.cn
                        </td>
                        <td>
                            客服热线：400-630-5006
                        </td>
                        <td>
                            宁波壹美壹家贸易有限公司
                        </td>
                        <td>
                            页码：1/1
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    </div>
    <div id="printDiv" class="NoPrint" style="position: absolute; z-index: 9999;">
        <a href="#" onclick="doPrint();return false;" style="text-decoration: none;" title='打印该页'>
            <img id='imgPrinter' src='/images/print.jpg'
                width="128" height="128" border='0' /></a>
    </div>
    </form>
</body>
</html>
